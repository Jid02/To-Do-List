<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo Web App</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .task-card {
            margin-bottom: 15px;
            border-left: 5px solid #0d6efd;
        }
        .task-card.completed {
            border-left: 5px solid #198754;
            opacity: 0.7;
        }
        .deadline-near {
            color: #dc3545;
            font-weight: bold;
        }
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .container {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">Todo Web App</h1>
        
        <!-- Task Form -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Add New Task</h5>
                <form id="taskForm">
                    <div class="mb-3">
                        <label for="taskName" class="form-label">Task Name</label>
                        <input type="text" class="form-control" id="taskName" required>
                    </div>
                    <div class="mb-3">
                        <label for="taskDescription" class="form-label">Detailed Description</label>
                        <textarea class="form-control" id="taskDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="taskDeadline" class="form-label">Deadline</label>
                        <input type="datetime-local" class="form-control" id="taskDeadline" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Task</button>
                </form>
            </div>
        </div>
        
        <!-- File Management Section -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Data Management</h5>
                <div class="d-flex gap-2">
                    <button id="exportBtn" class="btn btn-success">Export Tasks</button>
                    <button id="importBtn" class="btn btn-info">Import Tasks</button>
                    <input type="file" id="fileInput" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- Tasks Container -->
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">Your Tasks</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Filter
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="filterDropdown">
                            <li><a class="dropdown-item" href="#" data-filter="all">All Tasks</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="active">Active Tasks</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="completed">Completed Tasks</a></li>
                        </ul>
                    </div>
                </div>
                <div id="tasksContainer">
                    <!-- Tasks will appear here -->
                    <div class="text-center text-muted py-5" id="emptyMessage">
                        <p>No tasks yet. Add your first task above!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModalLabel">Edit Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId">
                        <div class="mb-3">
                            <label for="editTaskName" class="form-label">Task Name</label>
                            <input type="text" class="form-control" id="editTaskName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDescription" class="form-label">Detailed Description</label>
                            <textarea class="form-control" id="editTaskDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDeadline" class="form-label">Deadline</label>
                            <input type="datetime-local" class="form-control" id="editTaskDeadline" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTaskChanges">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let tasks = [];
        let currentFilter = 'all';
        
        // DOM elements
        const taskForm = document.getElementById('taskForm');
        const tasksContainer = document.getElementById('tasksContainer');
        const emptyMessage = document.getElementById('emptyMessage');
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const fileInput = document.getElementById('fileInput');
        const editTaskForm = document.getElementById('editTaskForm');
        const saveTaskChanges = document.getElementById('saveTaskChanges');
        const filterButtons = document.querySelectorAll('[data-filter]');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Load tasks from localStorage
            loadTasks();
            
            // Setup event listeners
            taskForm.addEventListener('submit', addTask);
            exportBtn.addEventListener('click', exportTasks);
            importBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', importTasks);
            saveTaskChanges.addEventListener('click', saveEditedTask);
            
            // Setup filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    currentFilter = e.target.dataset.filter;
                    renderTasks();
                });
            });
            
            // Render tasks
            renderTasks();
        });
        
        // Task operations
        function addTask(e) {
            e.preventDefault();
            
            const taskName = document.getElementById('taskName').value;
            const taskDescription = document.getElementById('taskDescription').value;
            const taskDeadline = document.getElementById('taskDeadline').value;
            
            const newTask = {
                id: Date.now().toString(),
                name: taskName,
                description: taskDescription,
                deadline: taskDeadline,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveTasks();
            renderTasks();
            
            // Clear form
            taskForm.reset();
        }
        
        function toggleTaskStatus(taskId) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].completed = !tasks[taskIndex].completed;
                saveTasks();
                renderTasks();
            }
        }
        
        function editTask(taskId) {
            const task = tasks.find(task => task.id === taskId);
            if (task) {
                document.getElementById('editTaskId').value = task.id;
                document.getElementById('editTaskName').value = task.name;
                document.getElementById('editTaskDescription').value = task.description;
                document.getElementById('editTaskDeadline').value = task.deadline;
                
                // Show modal
                const taskModal = new bootstrap.Modal(document.getElementById('taskModal'));
                taskModal.show();
            }
        }
        
        function saveEditedTask() {
            const taskId = document.getElementById('editTaskId').value;
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            
            if (taskIndex !== -1) {
                tasks[taskIndex].name = document.getElementById('editTaskName').value;
                tasks[taskIndex].description = document.getElementById('editTaskDescription').value;
                tasks[taskIndex].deadline = document.getElementById('editTaskDeadline').value;
                
                saveTasks();
                renderTasks();
                
                // Hide modal
                const taskModal = bootstrap.Modal.getInstance(document.getElementById('taskModal'));
                taskModal.hide();
            }
        }
        
        function deleteTask(taskId) {
            if (confirm("Are you sure you want to delete this task?")) {
                tasks = tasks.filter(task => task.id !== taskId);
                saveTasks();
                renderTasks();
            }
        }
        
        // Render functions
        function renderTasks() {
            // Filter tasks based on current filter
            let filteredTasks = tasks;
            if (currentFilter === 'active') {
                filteredTasks = tasks.filter(task => !task.completed);
            } else if (currentFilter === 'completed') {
                filteredTasks = tasks.filter(task => task.completed);
            }
            
            // Show or hide empty message
            if (filteredTasks.length === 0) {
                emptyMessage.style.display = 'block';
                tasksContainer.innerHTML = '';
                emptyMessage.innerHTML = tasks.length === 0 
                    ? '<p>No tasks yet. Add your first task above!</p>' 
                    : '<p>No tasks match your current filter.</p>';
                return;
            } else {
                emptyMessage.style.display = 'none';
            }
            
            // Sort tasks by deadline
            filteredTasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
            
            // Render task cards
            let tasksHTML = '';
            
            filteredTasks.forEach(task => {
                const deadlineDate = new Date(task.deadline);
                const now = new Date();
                const timeDiff = deadlineDate - now;
                const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                let deadlineClass = '';
                let deadlineText = formatDate(deadlineDate);
                
                if (timeDiff < 0) {
                    deadlineClass = 'deadline-near';
                    deadlineText += ' (Overdue)';
                } else if (daysLeft <= 3) {
                    deadlineClass = 'deadline-near';
                    deadlineText += daysLeft === 0 
                        ? ' (Today)' 
                        : daysLeft === 1 
                            ? ' (Tomorrow)' 
                            : ` (${daysLeft} days left)`;
                }
                
                tasksHTML += `
                <div class="card task-card ${task.completed ? 'completed' : ''}">
                    <div class="card-body">
                        <div class="task-header mb-2">
                            <h5 class="card-title mb-0">${task.name}</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" ${task.completed ? 'checked' : ''} 
                                    onchange="toggleTaskStatus('${task.id}')">
                                <label class="form-check-label">Complete</label>
                            </div>
                        </div>
                        <p class="card-text">${task.description}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted ${deadlineClass}">
                                <strong>Deadline:</strong> ${deadlineText}
                            </small>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" onclick="editTask('${task.id}')">Edit</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteTask('${task.id}')">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
            
            tasksContainer.innerHTML = tasksHTML;
        }
        
        // Helper functions
        function formatDate(date) {
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('en-US', options);
        }
        
        // Data persistence functions
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }
        
        function loadTasks() {
            const savedTasks = localStorage.getItem('tasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
        }
        
        // File operations 
        function exportTasks() {
            const tasksData = JSON.stringify(tasks, null, 2);
            const blob = new Blob([tasksData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `todo-tasks-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function importTasks(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTasks = JSON.parse(e.target.result);
                    if (Array.isArray(importedTasks)) {
                        if (confirm(`Import ${importedTasks.length} tasks? This will replace your current tasks.`)) {
                            tasks = importedTasks;
                            saveTasks();
                            renderTasks();
                            alert('Tasks imported successfully!');
                        }
                    } else {
                        throw new Error('Invalid task data format');
                    }
                } catch (error) {
                    alert('Error importing tasks: ' + error.message);
                }
                // Reset file input
                fileInput.value = '';
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
